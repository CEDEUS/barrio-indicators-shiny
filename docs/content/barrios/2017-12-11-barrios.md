---
title: Barrios
author: ''
date: '2017-12-11'
slug: barrios
categories: []
tags: []
menu: 'main'
weight: 0
---

## Database

Currently we have 32 barrios on 6 cities

| ID                         | BARRIO                                        | CIUDAD                      | COMUNA        |
|----------------------------|-----------------------------------------------|-----------------------------|---------------|
| 1                          | Barrio Amanecer                               | Temuco - Padre Las Casas    | Temuco        |
| 2                          | Barrio Estación                               | Temuco - Padre Las Casas    | Temuco        |
| 3                          | Camilo Henriquez                              | Gran Concepción             | Concepción    |
| 4                          | Fundo El Carmen                               | Temuco - Padre Las Casas    | Temuco        |
| 5                          | Lomas de San Sebastian                        | Gran Concepción             | Concepción    |
| 6                          | Villa Los Fundadores                          | Valdivia                    | Valdivia      |
| 7                          | Parque Krahmer                                | Valdivia                    | Valdivia      |
| 8                          | Sector Regional                               | Valdivia                    | Valdivia      |
| 9                          | Barrio Brasil                                 | Gran Santiago               | Santiago      |
| 10                         | Villa Codelco                                 | Copiapó                     | Copiapó       |
| 11                         | Tierra Viva Oriente                           | Copiapó                     | Copiapó       |
| 12                         | El Llano                                      | Gran Coquimbo               | Coquimbo      |
| 13                         | Villa Vista Hermosa                           | Gran Coquimbo               | La Serena     |
| 14                         | Barrio San Miguel                             | Gran Santiago               | San Miguel    |
| 15                         | Barrio Las Lilas                              | Gran Santiago               | Providencia   |
| 16                         | Barrio Jardin del Este                        | Gran Santiago               | Vitacura      |
| 17                         | Barrio Plaza de Maipú                         | Gran Santiago               | Maipú         |
| 18                         | Barrios Bajos                                 | Valdivia                    | Valdivia      |
| 19                         | Guayacán                                      | Gran Coquimbo               | Coquimbo      |
| 20                         | Villa Esperanza                               | Copiapó                     | Copiapó       |
| 21                         | El Faro Parte Alta                            | Gran Coquimbo               | Coquimbo      |
| 22                         | Juan XXIII                                    | Gran Coquimbo               | La Serena     |
| 23                         | Chorrillos                                    | Gran Santiago               | Independencia |
| 24                         | Brasilia                                      | Gran Santiago               | San Miguel    |
| 25                         | El Mariscal                                   | Gran Santiago               | Puente Alto   |
| 26                         | U.V. 35 José María Caro                       | Gran Santiago               | Lo Espejo     |
| 27                         | Pucará de Lasana                              | Gran Santiago               | Quilicura     |
| 28                         | Juan González Huerta                          | Gran Concepción             | Talcahuano    |
| 29                         | Cerro Verde Alto                              | Gran Concepción             | Penco         |
| 30                         | Leonera 2                                     | Gran Concepción             | Chiguayante   |
| 31                         | Padre Hurtado (CCSS)                          | Temuco - Padre Las Casas    | Temuco        |
| 32                         | Las Quilas                                    | Temuco - Padre Las Casas    | Temuco        |

## How to add a new barrio?

- First you have to download the shapes and load everything in R
- Add your current barrios file, and run the scripts in add_new_barrios folder

## Going deep in the three stage process

The following example code adds four new barrios to the platform. First, creates a SpatialPolygonDataFrame with the old and new barrios.

```
library(tidyverse)
library(rgdal)
library(rgeos)
library(sp)
library(maptools)

# You have to use the orig barrios file

barrios_p <- read_rds("orig/barrios_pil.RDS")

# Setting up the projection

crs <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +towgs84=0,0,0")

# Loading the barrios (this is an example)

br <- readOGR("nuevos_barrios_shp/barrioamanecer.shp", "barrioamanecer")
cd <- readOGR("nuevos_barrios_shp/barrioestacion.shp", "barrioestacion")
vo <- readOGR("nuevos_barrios_shp/camilohenriquez.shp", "camilohenriquez")
el <- readOGR("nuevos_barrios_shp/fundoelcarmen.shp", "fundoelcarmen")

# Join everything

nbarrios <- rbind(br,cd,vo,el)

# Adding data to the shape

nbarrios@data <- read_delim("Id	BARRIO	CIUDAD	COMUNA
0	Barrio Amanecer	Temuco	Temuco
0	Barrio Estación	Temuco	Temuco
0	Camilo Henriquez	Gran Concepción	Concepción
0	Fundo El Carmen	Temuco	Temuco
",delim="\t")

# Setting up the projection

nbarrios <- spTransform(nbarrios, crs)

# Join with the prexistent barrios 

barrios_p <- rbind(nbarrios,barrios_p)

# Adding data frame

barrios_p@data <- as.data.frame(barrios_p@data)

# Setting up the projection

barrios_p <- spTransform(barrios_p,CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +towgs84=0,0,0"))

# Writing file with the barrio shapes

write_rds(barrios_p,"barrios_pil.RDS")

rm(list=ls())
```

Second, the census buffer is created.

```
library(tidyverse)
library(rgdal)
library(rgeos)
library(sp)
library(maptools)
library(spdplyr)

#Loading barrios shape

barrios_p<-read_rds("barrios_pil.RDS")

# Ciudades Cedeus

sa <- readOGR("Mapa Manzanas sin CODSII (geometría buena) - Cartografia Precenso 2011 - Público/Carto_Region_13.gdb/","MANZANA")
sd <- readOGR("Mapa Manzanas sin CODSII (geometría buena) - Cartografia Precenso 2011 - Público/Carto_Region_14.gdb/","MANZANA")
fg <- readOGR("Mapa Manzanas sin CODSII (geometría buena) - Cartografia Precenso 2011 - Público/Carto_Region_4.gdb/","MANZANA")
ff <- readOGR("Mapa Manzanas sin CODSII (geometría buena) - Cartografia Precenso 2011 - Público/Carto_Region_3.gdb/","MANZANA")
kr <- readOGR("Mapa Manzanas sin CODSII (geometría buena) - Cartografia Precenso 2011 - Público/Carto_Region_9.gdb/","MANZANA")
pq <- readOGR("Mapa Manzanas sin CODSII (geometría buena) - Cartografia Precenso 2011 - Público/Carto_Region_8.gdb/","MANZANA")

# Joining shapes

barrios_m <- rbind(sa,sd,fg,ff,kr,pq)

# Establishing projection

crs <- CRS("+init=epsg:32719") # Projeccion

barrios_p <- spTransform(barrios_p, crs) 
barrios_m <- spTransform(barrios_m, crs)

# Creating buffer

buffer <- gBuffer(barrios_p, width=1000, byid=TRUE,capStyle="FLAT")

# Cutting

buffer <- over(buffer,barrios_m,returnList=TRUE)

barrios_list <- as.list(barrios_p@data$BARRIO)

barrios <- mapply(function(x) barrios_m[as.numeric(rownames(x)),], buffer)
barrios <- mapply(cbind, barrios, barrios_list, SIMPLIFY=F)
barrios <- lapply(barrios, setNames, c("CUT", "AREA_C", "MANZENT", "DISTRITO", "ZONA", "MANZANA", "SHAPE_Length", "SHAPE_Area", "BARRIO"))
barrios <- do.call(rbind, barrios)

# Setting up the projection

barrios <- spTransform(barrios,CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +towgs84=0,0,0"))

# Writing barrio's buffer with census manzanas

write_rds(barrios,"barrios_merged.RDS")
```

Third, the manzanas related to the barrio itself are extracted.

```
library(tidyverse)
library(rgdal)
library(rgeos)
library(sp)
library(maptools)
library(spdplyr)

# Reading last shapes

barrios_p<-read_rds("barrios_pil.RDS")
barrios_m<-read_rds("barrios_merged.RDS")

# Intersection

manzbarr <- over(barrios_p,barrios_m,returnList=TRUE)

# Joining

manzbarr <- do.call(rbind, manzbarr)

manzbarr<-left_join(barrios_p@data,manzbarr,by=c("BARRIO"))

# Writing census manzanas inside barrio polygon 

write_rds(manzbarr,"Manzanasbarriospiloto.RDS")
```